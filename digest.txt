Directory structure:
‚îî‚îÄ‚îÄ zoo-system/
    ‚îú‚îÄ‚îÄ README.md
    ‚îú‚îÄ‚îÄ index.php
    ‚îú‚îÄ‚îÄ actions/
    ‚îÇ   ‚îú‚îÄ‚îÄ animals/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ animal_create_action.php
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ animal_delete.php
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ animal_update_action.php
    ‚îÇ   ‚îú‚îÄ‚îÄ auth/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login_action.php
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logout.php
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ register_action.php
    ‚îÇ   ‚îî‚îÄ‚îÄ habitats/
    ‚îÇ       ‚îú‚îÄ‚îÄ habitat_create_action.php
    ‚îÇ       ‚îú‚îÄ‚îÄ habitat_delete.php
    ‚îÇ       ‚îî‚îÄ‚îÄ habitat_update_action.php
    ‚îú‚îÄ‚îÄ assets/
    ‚îÇ   ‚îî‚îÄ‚îÄ css/
    ‚îÇ       ‚îî‚îÄ‚îÄ style.css
    ‚îú‚îÄ‚îÄ includes/
    ‚îÇ   ‚îú‚îÄ‚îÄ auth_check.php
    ‚îÇ   ‚îú‚îÄ‚îÄ footer.php
    ‚îÇ   ‚îú‚îÄ‚îÄ functions.php
    ‚îÇ   ‚îî‚îÄ‚îÄ header.php
    ‚îî‚îÄ‚îÄ views/
        ‚îú‚îÄ‚îÄ admin/
        ‚îÇ   ‚îú‚îÄ‚îÄ animal_create.php
        ‚îÇ   ‚îú‚îÄ‚îÄ animal_edit.php
        ‚îÇ   ‚îú‚îÄ‚îÄ animals.php
        ‚îÇ   ‚îú‚îÄ‚îÄ habitat_create.php
        ‚îÇ   ‚îú‚îÄ‚îÄ habitat_edit.php
        ‚îÇ   ‚îî‚îÄ‚îÄ habitats.php
        ‚îî‚îÄ‚îÄ auth/
            ‚îú‚îÄ‚îÄ login.php
            ‚îî‚îÄ‚îÄ register.php

================================================
FILE: README.md
================================================
# ZooManager-PHP-Native
ZooManager: A comprehensive system in native PHP for zoo management. It includes secure authentication, user roles, and a complete CRUD interface for habitats and animals. It implements complex business logic for capacity control and species compatibility, a relational database, and a clean architecture ideal for academic defense.

ü¶Å ZooManager: Sistema de Gesti√≥n de Zool√≥gico
Bienvenido al repositorio oficial del proyecto. Este sistema ha sido dise√±ado para cumplir con los est√°ndares acad√©micos de desarrollo en PHP Nativo, enfoc√°ndose en la seguridad, la integridad de los datos y una arquitectura limpia.

üõ†Ô∏è Requisitos T√©cnicos Implementados
Para cumplir con la actividad, el proyecto incluye:

Autenticaci√≥n: Registro de usuarios, inicio de sesi√≥n con contrase√±as encriptadas y manejo de sesiones seguras.

CRUD Completo: Gesti√≥n de la entidad principal (Animales) con operaciones de Crear, Leer, Actualizar y Eliminar (con confirmaci√≥n).

Base de Datos: Estructura relacional con 4 tablas vinculadas mediante llaves primarias y for√°neas.

Arquitectura: Organizaci√≥n modular de carpetas para separar la l√≥gica de procesamiento (actions/) de la interfaz visual (views/).

üß† Regla de Negocio Compleja (Validaci√≥n Especial)
Nuestro diferencial y requisito obligatorio es la Validaci√≥n de Capacidad y Compatibilidad:

Validaci√≥n de Capacidad: Antes de registrar un animal, el sistema consulta la tabla habitats para verificar si hay cupo disponible.

Validaci√≥n de Clima: Se cruza la informaci√≥n entre la especie y el tipo de h√°bitat. No se permite asignar un animal a un entorno que no sea compatible con su clima biol√≥gico.

üìÇ Gu√≠a de Estructura para Programadores
Para mantener el orden, sigamos estas reglas:

Vistas (/views): Solo contienen HTML y echo de PHP para mostrar datos. No procesan formularios.

Acciones (/actions): Aqu√≠ va la l√≥gica pura. Reciben datos por POST, validan, ejecutan SQL y redireccionan.


Seguridad: Toda p√°gina administrativa debe incluir el archivo auth_check.php al inicio para verificar la sesi√≥n activa.

üöÄ C√≥mo empezar
Clona el repositorio en tu carpeta local del servidor (ej. htdocs).

Crea el archivo config/db.php (no se sube al repo por seguridad) con tus credenciales locales.


================================================
FILE: index.php
================================================
Error reading file with 'cp1252': 'charmap' codec can't decode byte 0x90 in position 1079: character maps to <undefined>


================================================
FILE: actions/animals/animal_create_action.php
================================================
<?php
session_start();
require_once '../../config/db.php';
require_once '../../includes/functions.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $nombre = limpiar($_POST['nombre']);
    $especie = limpiar($_POST['especie']);
    $edad = limpiar($_POST['edad']);
    $fecha = $_POST['fecha_llegada'];
    $habitat_id = $_POST['habitat_id'];

    if (empty($nombre) || empty($especie) || empty($habitat_id)) {
        $_SESSION['error'] = "Por favor completa todos los campos obligatorios.";
        header("Location: ../../views/admin/animal_create.php");
        exit();
    }

    try {
        // --- INICIO DE VALIDACI√É‚ÄúN COMPLEJA ---
        
        // 1. Consultar la capacidad m√É¬°xima del h√É¬°bitat y cu√É¬°ntos animales tiene ya.
        $sql_check = "SELECT 
                        h.capacidad, 
                        (SELECT COUNT(*) FROM animals WHERE habitat_id = h.id) as total_actual 
                        FROM habitats h 
                        WHERE h.id = ?";
        
        $stmt_check = $pdo->prepare($sql_check);
        $stmt_check->execute([$habitat_id]);
        $info_habitat = $stmt_check->fetch();

        // 2. L√É¬≥gica de negocio: Comparar capacidad vs actual
        if ($info_habitat['total_actual'] >= $info_habitat['capacidad']) {
            $_SESSION['error'] = "El h√É¬°bitat seleccionado ya alcanz√É¬≥ su capacidad m√É¬°xima ({$info_habitat['capacidad']}).";
            header("Location: ../../views/admin/animal_create.php");
            exit();
        }
        
        // --- FIN DE VALIDACI√É‚ÄúN COMPLEJA ---

        // 4. INSERTAR (Si pas√É¬≥ la validaci√É¬≥n)
        $sql = "INSERT INTO animals (nombre, especie, edad, fecha_llegada, habitat_id) 
                VALUES (?, ?, ?, ?, ?)";
        $stmt = $pdo->prepare($sql);
        $stmt->execute([$nombre, $especie, $edad, $fecha, $habitat_id]);

        // 5. MENSAJE DE √É‚Ä∞XITO (Consistencia)
        $_SESSION['success'] = "√Ç¬°Animal registrado exitosamente en el sistema!";
        header("Location: ../../views/admin/animals.php");
        exit();

    } catch (PDOException $e) {
        $_SESSION['error'] = "Error t√É¬©cnico: " . $e->getMessage();
        header("Location: ../../views/admin/animal_create.php");
        exit();
    }
}


================================================
FILE: actions/animals/animal_delete.php
================================================
<?php
/*
    ---------------------------------------------------
    L√É‚ÄúGICA DE ELIMINACI√É‚ÄúN (DELETE)
    ---------------------------------------------------
*/
session_start();
require_once '../../config/db.php';
require_once '../../includes/auth_check.php'; // Solo usuarios logueados borran
require_once '../../includes/functions.php';

if (!esAdmin()) {
    $_SESSION['error'] = "No tienes permisos para eliminar animales.";
    header("Location: ../../views/admin/animals.php");
    exit();
}

// 1. OBTENER EL ID POR URL
// El ID viene de: animal_delete.php?id=5
$id = isset($_GET['id']) ? $_GET['id'] : null;

if ($id) {
    try {
        // 2. PREPARAR LA ELIMINACI√É‚ÄúN
        $sql = "DELETE FROM animals WHERE id = ?";
        $stmt = $pdo->prepare($sql);
        
        // 3. EJECUTAR
        if ($stmt->execute([$id])) {
            $_SESSION['success'] = "Animal eliminado correctamente.";
        } else {
            $_SESSION['error'] = "No se pudo eliminar el registro.";
        }

    } catch (PDOException $e) {
        $_SESSION['error'] = "Error de base de datos: " . $e->getMessage();
    }
}

// 4. REDIRECCIONAR DE VUELTA A LA LISTA
header("Location: ../../views/admin/animals.php");
exit();
?>


================================================
FILE: actions/animals/animal_update_action.php
================================================
<?php
session_start();
require_once '../../config/db.php';
require_once '../../includes/functions.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $id = $_POST['id'];
    $nombre = limpiar($_POST['nombre']);
    $especie = limpiar($_POST['especie']);
    $edad = $_POST['edad'];
    $fecha = $_POST['fecha_llegada'];
    $habitat_id = $_POST['habitat_id'];

    try {
        // --- VALIDACI√É‚ÄúN COMPLEJA PARA EDICI√É‚ÄúN ---
        
        // Verificamos si el animal est√É¬° cambiando de h√É¬°bitat
        $stmt_current = $pdo->prepare("SELECT habitat_id FROM animals WHERE id = ?");
        $stmt_current->execute([$id]);
        $current_habitat = $stmt_current->fetchColumn();

        // Si el h√É¬°bitat destino es diferente al actual, verificamos cupo
        if ($current_habitat != $habitat_id) {
            $sql_check = "SELECT capacidad, 
                        (SELECT COUNT(*) FROM animals WHERE habitat_id = h.id) as total 
                        FROM habitats h WHERE id = ?";
            $stmt_check = $pdo->prepare($sql_check);
            $stmt_check->execute([$habitat_id]);
            $res = $stmt_check->fetch();

            if ($res['total'] >= $res['capacidad']) {
                $_SESSION['error'] = "No se puede mover al animal. El h√É¬°bitat destino est√É¬° lleno.";
                header("Location: ../../views/admin/animal_edit.php?id=" . $id);
                exit();
            }
        }

        // --- ACTUALIZACI√É‚ÄúN ---
        $sql = "UPDATE animals SET nombre = ?, especie = ?, edad = ?, fecha_llegada = ?, habitat_id = ? WHERE id = ?";
        $stmt = $pdo->prepare($sql);
        $stmt->execute([$nombre, $especie, $edad, $fecha, $habitat_id, $id]);

        $_SESSION['success'] = "Datos del animal actualizados correctamente.";
        header("Location: ../../views/admin/animals.php");
        exit();

    } catch (PDOException $e) {
        $_SESSION['error'] = "Error al actualizar: " . $e->getMessage();
        header("Location: ../../views/admin/animal_edit.php?id=" . $id);
        exit();
    }
}


================================================
FILE: actions/auth/login_action.php
================================================
<?php
// 1. INICIAR SESI√ìN
// Necesario para guardar los datos del usuario si el login es exitoso.
session_start();

// 2. CONEXI√ìN A LA BASE DE DATOS
require_once '../../config/db.php';
require_once '../../includes/functions.php';

// 3. VERIFICAR M√âTODO POST
// Solo procesamos si los datos vienen del formulario.
if ($_SERVER['REQUEST_METHOD'] === 'POST') {

    // 4. LIMPIEZA DE DATOS
    $email = limpiar($_POST['email']);
    $password_ingresada = $_POST['password'];

    // 5. VALIDACI√ìN DE CAMPOS VAC√çOS
    if (empty($email) || empty($password_ingresada)) {
        $_SESSION['error'] = "Por favor, completa todos los campos.";
        header("Location: ../../views/auth/login.php");
        exit();
    }

    try {
        // 6. BUSCAR AL USUARIO POR EMAIL
        // Preparamos la consulta SQL para evitar inyecci√≥n de c√≥digo.
        $stmt = $pdo->prepare("SELECT * FROM users WHERE email = ?");
        $stmt->execute([$email]);
        
        // fetch(PDO::FETCH_ASSOC) nos devuelve los datos del usuario como un array asociativo.
        $usuario = $stmt->fetch(PDO::FETCH_ASSOC);

        // 7. VERIFICACI√ìN DE CREDENCIALES
        // Revisamos dos cosas:
        // A) ¬øExiste el usuario? ($usuario no es falso)
        // B) ¬øLa contrase√±a coincide? Usamos password_verify() que compara texto plano vs hash.
        if ($usuario && password_verify($password_ingresada, $usuario['password'])) {
            
            // --- ¬°LOGIN EXITOSO! ---

            // 8. GUARDAR DATOS EN LA SESI√ìN
            // Estas variables estar√°n disponibles en TODAS las p√°ginas (header.php las usa).
            $_SESSION['user_id'] = $usuario['id'];
            $_SESSION['user_name'] = $usuario['nombre_completo'];
            $_SESSION['user_role'] = $usuario['rol']; // Importante para permisos de Admin/Cuidador

            // 9. REDIRECCIONAR AL DASHBOARD
            // Por ahora vamos al inicio, pero luego iremos al panel de administraci√≥n.
            header("Location: ../../index.php");
            exit();

        } else {
            // --- LOGIN FALLIDO ---
            
            // Nota de Seguridad: No decimos "El usuario no existe" o "La contrase√±a est√° mal".
            // Decimos "Credenciales incorrectas" para no dar pistas a hackers.
            $_SESSION['error'] = "Credenciales incorrectas. Int√©ntalo de nuevo.";
            header("Location: ../../views/auth/login.php");
            exit();
        }

    } catch (PDOException $e) {
        // 10. ERROR T√âCNICO
        die("Error en el sistema de login: " . $e->getMessage());
    }

} else {
    // Si intentan entrar directo por URL, los devolvemos al formulario.
    header("Location: ../../views/auth/login.php");
    exit();
}


================================================
FILE: actions/auth/logout.php
================================================
<?php
// 1. INICIAR LA SESI√É‚ÄúN
// Aunque suene contradictorio, necesitamos "entrar" a la sesi√É¬≥n actual para poder destruirla.
session_start();

// 2. LIMPIAR TODAS LAS VARIABLES DE SESI√É‚ÄúN
// Vaciamos el array $_SESSION para borrar datos como el ID, nombre y rol de la memoria inmediata.
$_SESSION = [];

// 3. DESTRUIR LA COOKIE DE SESI√É‚ÄúN (Limpieza profunda)
// Esto borra la "llave" f√É¬≠sica que estaba guardada en el navegador del usuario.
if (ini_get("session.use_cookies")) {
    $params = session_get_cookie_params();
    setcookie(session_name(), '', time() - 42000,
        $params["path"], $params["domain"],
        $params["secure"], $params["httponly"]
    );
}

// 4. DESTRUIR LA SESI√É‚ÄúN EN EL SERVIDOR
// Esto elimina el archivo f√É¬≠sico en el servidor donde se guardaban los datos.
session_destroy();

// 5. REDIRECCIONAR AL LOGIN
// Enviamos al usuario fuera del sistema.
header("Location: ../../views/auth/login.php");
exit();
?>


================================================
FILE: actions/auth/register_action.php
================================================
<?php
// 1. INICIAR SESI√ìN
// La necesitamos para guardar mensajes de error o √©xito que mostraremos en la vista.
session_start();

// 2. IMPORTAR LA CONEXI√ìN (La "llave" del zool√≥gico)
// Usamos ../../ para salir de actions/auth/ y llegar a la carpeta config/
require_once '../../config/db.php';
require_once '../../includes/functions.php';

// 3. VERIFICAR QUE LOS DATOS LLEGUEN POR POST
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    
    // 4. CAPTURAR Y LIMPIAR LOS DATOS
    $nombre = limpiar($_POST['nombre_completo']);
    $email = limpiar($_POST['email']);
    $password_plana = $_POST['password']; // La clave tal cual la escribi√≥ el usuario
    $rol = $_POST['rol'];

    // 5. VALIDACI√ìN B√ÅSICA (Manejo de errores exigido)
    if (empty($nombre) || empty($email) || empty($password_plana)) {
        $_SESSION['error'] = "Todos los campos son obligatorios.";
        header("Location: ../../views/auth/register.php");
        exit();
    }

    try {
        // 6. VERIFICAR SI EL EMAIL YA EXISTE
        // Usamos una "Consulta Preparada" (PDO) para evitar Inyecci√≥n SQL.
        $stmt = $pdo->prepare("SELECT id FROM users WHERE email = ?");
        $stmt->execute([$email]);
        
        if ($stmt->fetch()) {
            $_SESSION['error'] = "Este correo ya est√° registrado en el sistema.";
            header("Location: ../../views/auth/register.php");
            exit();
        }

        // 7. ENCRIPTAR LA CONTRASE√ëA (Requisito Obligatorio #1)
        // Nunca guardamos claves en texto plano. password_hash crea una versi√≥n ilegible.
        $password_encriptada = password_hash($password_plana, PASSWORD_DEFAULT);

        // 8. INSERTAR EL NUEVO USUARIO
        $sql = "INSERT INTO users (nombre_completo, email, password, rol) VALUES (?, ?, ?, ?)";
        $insert = $pdo->prepare($sql);
        $insert->execute([$nombre, $email, $password_encriptada, $rol]);

        // 9. √âXITO: REDIRECCIONAR AL LOGIN
        $_SESSION['success'] = "Usuario registrado correctamente. Ya puedes iniciar sesi√≥n.";
        header("Location: ../../views/auth/login.php");
        exit();

    } catch (PDOException $e) {
        // 10. MANEJO DE ERRORES CR√çTICOS
        die("Error t√©cnico en la base de datos: " . $e->getMessage());
    }

} else {
    // Si alguien intenta entrar a este archivo directamente por la URL, lo mandamos al registro.
    header("Location: ../../views/auth/register.php");
    exit();
}


================================================
FILE: actions/habitats/habitat_create_action.php
================================================
<?php
session_start();
require_once '../../config/db.php';
require_once '../../includes/functions.php'; // Necesario para la funci√É¬≥n limpiar

if ($_SERVER['REQUEST_METHOD'] === 'POST') {

    // 1. Limpieza de datos
    $nombre = limpiar($_POST['nombre']);
    $tipo = limpiar($_POST['clima']);
    $capacidad = (int) $_POST['capacidad'];
    $descripcion = limpiar($_POST['descripcion']);

    // 2. Validaci√É¬≥n b√É¬°sica
    if (empty($nombre) || empty($tipo) || $capacidad < 1) {
        $_SESSION['error'] = "Por favor, revisa los campos. La capacidad debe ser al menos 1.";
        header("Location: ../../views/admin/habitat_create.php");
        exit();
    }

    try {
        // 3. Verificar duplicados
        // Regla de negocio: No pueden haber dos h√É¬°bitats con el mismo nombre exacto
        $check = $pdo->prepare("SELECT id FROM habitats WHERE nombre = ?");
        $check->execute([$nombre]);
        
        if ($check->rowCount() > 0) {
            $_SESSION['error'] = "Error: Ya existe un h√É¬°bitat llamado '$nombre'.";
            header("Location: ../../views/admin/habitat_create.php");
            exit();
        }

        // 4. Insertar
        $sql = "INSERT INTO habitats (nombre, clima, capacidad, descripcion) VALUES (?, ?, ?, ?)";
        $stmt = $pdo->prepare($sql);
        
        if ($stmt->execute([$nombre, $tipo, $capacidad, $descripcion])) {
            $_SESSION['success'] = "H√É¬°bitat '$nombre' creado exitosamente.";
            header("Location: ../../views/admin/habitats.php");
            exit();
        }

    } catch (PDOException $e) {
        $_SESSION['error'] = "Error en base de datos: " . $e->getMessage();
        header("Location: ../../views/admin/habitat_create.php");
        exit();
    }
}


================================================
FILE: actions/habitats/habitat_delete.php
================================================
<?php
session_start();
require_once '../../config/db.php';
require_once '../../includes/auth_check.php';
require_once '../../includes/functions.php';

// 1. VERIFICAR PERMISOS DE ADMINISTRADOR
// Solo el admin puede destruir h√É¬°bitats.
if (!esAdmin()) {
    $_SESSION['error'] = "Acceso denegado. Solo administradores pueden eliminar h√É¬°bitats.";
    header("Location: ../../views/admin/habitats.php");
    exit();
}

$id = isset($_GET['id']) ? $_GET['id'] : null;

if ($id) {
    try {
        // 2. VERIFICAR SI HAY ANIMALES DENTRO (OPCIONAL PERO RECOMENDADO)
        // Aunque la BD tenga "SET NULL", es bueno avisar o limpiar.
        // En este caso, confiamos en la restricci√É¬≥n de la BD, pero ejecutamos el delete.

        $sql = "DELETE FROM habitats WHERE id = ?";
        $stmt = $pdo->prepare($sql);
        
        if ($stmt->execute([$id])) {
            $_SESSION['success'] = "H√É¬°bitat eliminado. Los animales asociados (si hab√É¬≠a) ahora est√É¬°n sin asignar.";
        } else {
            $_SESSION['error'] = "No se pudo eliminar el h√É¬°bitat.";
        }

    } catch (PDOException $e) {
        // Captura si hay un error de llave for√É¬°nea u otro problema t√É¬©cnico
        $_SESSION['error'] = "Error de base de datos: " . $e->getMessage();
    }
}

// 3. VOLVER A LA LISTA
header("Location: ../../views/admin/habitats.php");
exit();
?>


================================================
FILE: actions/habitats/habitat_update_action.php
================================================
<?php
session_start();
require_once '../../config/db.php';
require_once '../../includes/functions.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {

    // 1. CAPTURAR DATOS
    $id = $_POST['id'];
    $nombre = limpiar($_POST['nombre']);
    $clima = limpiar($_POST['clima']);
    $capacidad_nueva = (int) $_POST['capacidad'];
    $descripcion = limpiar($_POST['descripcion']);

    // 2. VALIDAR QUE NO EST√âN VAC√çOS
    if (empty($nombre) || empty($clima) || $capacidad_nueva < 1) {
        $_SESSION['error'] = "Datos inv√°lidos. La capacidad debe ser mayor a 0.";
        header("Location: ../../views/admin/habitat_edit.php?id=" . $id);
        exit();
    }

    try {
        // 3. VALIDACI√ìN L√ìGICA DE NEGOCIO (INTEGRIDAD)
        // No podemos reducir la capacidad a un n√∫mero menor a la cantidad de animales que ya viven ah√≠.
        
        // A) Contamos cu√°ntos animales hay actualmente en este h√°bitat
        $stmt_count = $pdo->prepare("SELECT COUNT(*) FROM animals WHERE habitat_id = ?");
        $stmt_count->execute([$id]);
        $ocupacion_actual = $stmt_count->fetchColumn();

        // B) Si intentas bajar la capacidad a 5, pero hay 8 animales, damos error.
        if ($capacidad_nueva < $ocupacion_actual) {
            $_SESSION['error'] = "No puedes reducir la capacidad a $capacidad_nueva. Actualmente hay $ocupacion_actual animales asignados.";
            header("Location: ../../views/admin/habitat_edit.php?id=" . $id);
            exit();
        }

        // 4. PREPARAR LA ACTUALIZACI√ìN
        $sql = "UPDATE habitats SET nombre = ?, clima = ?, capacidad = ?, descripcion = ? WHERE id = ?";
        $stmt = $pdo->prepare($sql);
        
        // 5. EJECUTAR
        if ($stmt->execute([$nombre, $clima, $capacidad_nueva, $descripcion, $id])) {
            $_SESSION['success'] = "H√°bitat actualizado correctamente.";
            header("Location: ../../views/admin/habitats.php");
            exit();
        }

    } catch (PDOException $e) {
        $_SESSION['error'] = "Error al actualizar: " . $e->getMessage();
        header("Location: ../../views/admin/habitat_edit.php?id=" . $id);
        exit();
    }
}


================================================
FILE: assets/css/style.css
================================================
/* --- ESTILOS GENERALES --- */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f9; /* Color de fondo suave */
    color: #333;
}

.container {
    width: 90%;
    max-width: 1000px; /* Ancho m√É¬°ximo para que no se estire mucho */
    margin: 0 auto;    /* Centrar contenido */
    padding: 20px 0;
}

/* --- BARRA DE NAVEGACI√É‚ÄúN --- */
.main-nav {
    background-color: #2c3e50; /* Azul oscuro corporativo */
    color: white;
    padding: 15px 0;
}

.nav-container {
    display: flex;             /* Pone el logo y el men√É¬∫ en la misma l√É¬≠nea */
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-size: 24px;
    font-weight: bold;
    color: white;
    text-decoration: none;
}

/* --- MEN√É≈° --- */
.menu {
    list-style: none; /* Quita los puntos de la lista */
    margin: 0;
    padding: 0;
    display: flex;    /* Pone los botones uno al lado del otro */
    gap: 20px;        /* Espacio entre botones */
}

.menu a {
    color: #ecf0f1;
    text-decoration: none;
    font-size: 16px;
}

.menu a:hover {
    color: #3498db; /* Azul claro al pasar el mouse */
}

/* --- BOTONES ESPECIALES --- */
.btn-register {
    background-color: #3498db;
    padding: 8px 15px;
    border-radius: 5px;
}

.menu .btn-register:hover {
    color: white; 
    background-color: #154e73;
}

.btn-logout {
    background-color: #e74c3c; /* Rojo para salir */
    padding: 5px 10px;
    border-radius: 4px;
}

/* --- TABLAS (Para el futuro CRUD) --- */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background: white;
}

th, td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: left;
}

th {
    background-color: #2c3e50;
    color: white;
}

/* --- ESTILOS DE FORMULARIOS --- */
.auth-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 70vh;
}

.auth-card {
    background: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 400px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.form-group input, .form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box; /* Importante para que el padding no estire el input */
}

.btn-submit {
    width: 100%;
    background-color: #27ae60; /* Verde zool√É¬≥gico */
    color: white;
    padding: 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
}

.btn-submit:hover {
    background-color: #219150;
}

.auth-link {
    text-align: center;
    margin-top: 15px;
    font-size: 0.9em;
}

/* --- ESTILOS DE ALERTAS --- */
.alert {
    padding: 12px;
    margin-bottom: 20px;
    border-radius: 4px;
    font-size: 0.9em;
    text-align: center;
    font-weight: bold;
}

.alert-error {
    background-color: #f8d7da; /* Rojo suave */
    color: #721c24;           /* Texto rojo oscuro */
    border: 1px solid #f5c6cb;
}

.alert-success {
    background-color: #d4edda; /* Verde suave */
    color: #155724;           /* Texto verde oscuro */
    border: 1px solid #c3e6cb;
}




================================================
FILE: includes/auth_check.php
================================================
<?php
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

if (!isset($_SESSION['user_id'])) {
    $_SESSION['error'] = "Acceso denegado. Debes iniciar sesi√É¬≥n.";
    
    header("Location: /zoo-system/views/auth/login.php");
    exit();
}


================================================
FILE: includes/footer.php
================================================
            </main> 
            <footer style="text-align: center; margin-top: 50px; padding: 20px; color: #777; font-size: 0.9em; border-top: 1px solid #eee;">
            <div class="container">
                <p>&copy; <?php echo date('Y'); ?> ZooManager - Proyecto Universitario PHP Nativo</p>
                <small>Desarrollado con fines acad√É¬©micos</small>
            </div>
        </footer>
    </body>
</html>


================================================
FILE: includes/functions.php
================================================
<?php
/**
 * ARCHIVO DE FUNCIONES GLOBALES
 * Aqu√É¬≠ centralizamos la l√É¬≥gica repetitiva para que el sistema sea f√É¬°cil de mantener.
 */

// 1. LIMPIEZA DE ENTRADAS (Seguridad XSS)
function limpiar($dato) {
    // trim: elimina espacios al inicio y final
    // htmlspecialchars: convierte caracteres especiales en entidades HTML
    // (Ej: "<" se convierte en "&lt;"), evitando que ejecuten scripts maliciosos.
    return htmlspecialchars(trim($dato), ENT_QUOTES, 'UTF-8');
}

// 2. FORMATEO DE FECHAS
function formatearFecha($fecha) {
    // Convierte "2026-01-17" en "17 de Enero, 2026" (o el formato que prefieras)
    if (empty($fecha)) return "N/A";
    return date('d/m/Y', strtotime($fecha));
}

// 3. GENERADOR DE ALERTAS (Consistencia de Mensajes)
function mostrarAlertas() {
    $salida = "";
    
    // Verificamos si hay mensajes de error en la sesi√É¬≥n
    if (isset($_SESSION['error'])) {
        $salida .= "<div class='alert alert-error'>" . $_SESSION['error'] . "</div>";
        unset($_SESSION['error']); // Lo borramos para que no se repita
    }
    
    // Verificamos si hay mensajes de √É¬©xito
    if (isset($_SESSION['success'])) {
        $salida .= "<div class='alert alert-success'>" . $_SESSION['success'] . "</div>";
        unset($_SESSION['success']);
    }
    
    return $salida;
}

// 4. VERIFICADOR DE ROLES (Seguridad extra)

// Comprueba si es Admin (Para borrar o gestionar usuarios)
function esAdmin() {
    return isset($_SESSION['user_role']) && $_SESSION['user_role'] === 'admin';
}

// Comprueba si es Cuidador (Para historiales m√É¬©dicos)
function esCuidador() {
    return isset($_SESSION['user_role']) && $_SESSION['user_role'] === 'cuidador';
}

// Comprueba si tiene CUALQUIERA de los dos (Para ver la lista de animales)
function puedeVerAnimales() {
    return isset($_SESSION['user_role']) && 
        ($_SESSION['user_role'] === 'admin' || $_SESSION['user_role'] === 'cuidador');
}


================================================
FILE: includes/header.php
================================================
<?php
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

require_once 'functions.php';

// Definimos la constante si no existe para evitar errores de re-definici√≥n
if (!defined('BASE_URL')) {
    define('BASE_URL', 'http://localhost/zoo-system/');
}
?>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo $pageTitle ?? 'ZooManager'; ?> - Sistema de Gesti√≥n</title>
    
    <link rel="stylesheet" href="<?php echo BASE_URL; ?>assets/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
</head>
<body>

    <nav class="navbar navbar-expand-sm bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="<?php echo BASE_URL; ?>index.php">ü¶Å ZooSystem</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                    <?php if (isset($_SESSION['user_id'])): ?>
                        <li class="nav-item"><span class="nav-link text-dark"><?php echo htmlspecialchars($_SESSION['user_name']); ?> (<?php echo $_SESSION['user_role']; ?>)</span></li>
                        <?php if (puedeVerAnimales()): ?>
                            <li class="nav-item">
                                <a class="nav-link" href="<?php echo BASE_URL; ?>views/admin/animals.php">Animales</a>
                            </li>  
                        <?php endif; ?>
                        <li class="nav-item">
                            <a class="nav-link" href="<?php echo BASE_URL; ?>views/admin/habitats.php">H√°bitats</a>
                        </li>
                    <?php else: ?>
                        <li class="nav-item">
                            <a class="nav-link" href="<?php echo BASE_URL; ?>index.php">Inicio</a>
                        </li>
                    <?php endif; ?>
                    
                </ul>

                <div class="d-flex">
                    <?php if (isset($_SESSION['user_id'])): ?>
                        <a href="<?php echo BASE_URL; ?>actions/auth/logout.php" class="btn btn-outline-danger">Salir</a>
                    <?php else: ?>
                        <a href="<?php echo BASE_URL; ?>views/auth/login.php" class="btn btn-outline-primary me-2">Entrar</a>
                        <a href="<?php echo BASE_URL; ?>views/auth/register.php" class="btn btn-primary">Registrarse</a>
                    <?php endif; ?>
                </div>

            </div>
        </div>
    </nav>
    <main class="container">


================================================
FILE: views/admin/animal_create.php
================================================
<?php
// 1. EL GUARDIA DE SEGURIDAD
require '../../includes/auth_check.php';
require '../../includes/header.php';
require '../../config/db.php';

// 2. OBTENER LOS H√ÅBITATS PARA EL SELECT
// Necesitamos llenar el men√∫ desplegable con opciones reales de la BD.
try {
    // IMPORTANTE: Tu tabla usa 'nombre', no necesitamos cambiar esta consulta
    $stmt = $pdo->query("SELECT id, nombre FROM habitats");
    $habitats = $stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    $error = "Error al cargar h√°bitats.";
}
?>

<div class="auth-container"> <div class="auth-card" style="max-width: 600px;"> <div class="admin-header">
            <h2>Registrar Nuevo Animal</h2>
            <a href="animals.php" class="btn-delete" style="background:#7f8c8d;">Cancelar</a>
        </div>

        <p>Completa los datos del nuevo integrante del zool√≥gico.</p>

        <?php if (isset($_SESSION['error'])): ?>
            <div class="alert alert-error">
                <?php echo $_SESSION['error']; unset($_SESSION['error']); ?>
            </div>
        <?php endif; ?>

        <form action="../../actions/animals/animal_create_action.php" method="POST" class="form-standard">
            
            <div class="form-group">
                <label>Nombre del Animal:</label>
                <input type="text" name="nombre" required placeholder="Ej: Simba">
            </div>

            <div class="form-group">
                <label>Especie:</label>
                <input type="text" name="especie" required placeholder="Ej: Le√≥n Africano">
            </div>

            <div class="row" style="display:flex; gap:15px;">
                <div class="form-group" style="flex:1;">
                    <label>Edad (A√±os):</label>
                    <input type="number" name="edad" required min="0">
                </div>
                
                <div class="form-group" style="flex:1;">
                    <label>Fecha de Llegada:</label>
                    <input type="date" name="fecha_llegada" required value="<?php echo date('Y-m-d'); ?>">
                </div>
            </div>

            <div class="form-group">
                <label>Asignar H√°bitat:</label>
                <select name="habitat_id" required>
                    <option value="">-- Selecciona un h√°bitat --</option>
                    
                    <?php foreach ($habitats as $h): ?>
                        <option value="<?php echo $h['id']; ?>">
                            <?php echo limpiar($h['nombre']); ?>
                        </option>
                    <?php endforeach; ?>
                    
                </select>
            </div>

            <button type="submit" class="btn-submit">Guardar Animal</button>
        </form>
    </div>
</div>

<?php require '../../includes/footer.php'; ?>


================================================
FILE: views/admin/animal_edit.php
================================================
<?php
require '../../includes/auth_check.php';
require '../../includes/header.php';
require '../../config/db.php';

// 1. OBTENER EL ANIMAL A EDITAR
$id = $_GET['id'] ?? null;
if (!$id) { header("Location: animals.php"); exit(); }

try {
    // Traemos los datos del animal
    $stmt = $pdo->prepare("SELECT * FROM animals WHERE id = ?");
    $stmt->execute([$id]);
    $animal = $stmt->fetch();

    // Traemos los h√É¬°bitats para el select
    $h_stmt = $pdo->query("SELECT id, nombre FROM habitats");
    $habitats = $h_stmt->fetchAll();

    if (!$animal) { die("Animal no encontrado."); }
} catch (PDOException $e) {
    die("Error: " . $e->getMessage());
}
?>

<div class="auth-container">
    <div class="auth-card" style="max-width: 600px;">
        <h2>Editar Animal: <?php echo limpiar($animal['nombre']); ?></h2>
        
        <form action="../../actions/animals/animal_update_action.php" method="POST" class="form-standard">
            <input type="hidden" name="id" value="<?php echo $animal['id']; ?>">

            <div class="form-group">
                <label>Nombre:</label>
                <input type="text" name="nombre" value="<?php echo limpiar($animal['nombre']); ?>" required>
            </div>

            <div class="form-group">
                <label>Especie:</label>
                <input type="text" name="especie" value="<?php echo limpiar($animal['especie']); ?>" required>
            </div>

            <div class="row" style="display:flex; gap:15px;">
                <div class="form-group" style="flex:1;">
                    <label>Edad:</label>
                    <input type="number" name="edad" value="<?php echo $animal['edad']; ?>" required>
                </div>
                <div class="form-group" style="flex:1;">
                    <label>Fecha Llegada:</label>
                    <input type="date" name="fecha_llegada" value="<?php echo $animal['fecha_llegada']; ?>" required>
                </div>
            </div>

            <div class="form-group">
                <label>H√É¬°bitat:</label>
                <select name="habitat_id" required>
                    <?php foreach ($habitats as $h): ?>
                        <option value="<?php echo $h['id']; ?>" <?php echo ($h['id'] == $animal['habitat_id']) ? 'selected' : ''; ?>>
                            <?php echo limpiar($h['nombre']); ?>
                        </option>
                    <?php endforeach; ?>
                </select>
            </div>

            <button type="submit" class="btn-submit" style="background:#f39c12;">Actualizar Datos</button>
            <a href="animals.php" style="display:block; text-align:center; margin-top:10px; color:#7f8c8d;">Volver atr√É¬°s</a>
        </form>
    </div>
</div>

<?php require '../../includes/footer.php'; ?>


================================================
FILE: views/admin/animals.php
================================================
Error reading file with 'cp1252': 'charmap' codec can't decode byte 0x90 in position 1347: character maps to <undefined>


================================================
FILE: views/admin/habitat_create.php
================================================
[Binary file]


================================================
FILE: views/admin/habitat_edit.php
================================================
<?php
// 1. SEGURIDAD Y CONEXI√É‚ÄúN
require '../../includes/auth_check.php';
require '../../includes/header.php';
require '../../config/db.php';

// 2. OBTENER EL ID Y VALIDAR
$id = $_GET['id'] ?? null;

if (!$id) {
    $_SESSION['error'] = "ID de h√É¬°bitat no especificado.";
    header("Location: habitats.php");
    exit();
}

try {
    // 3. BUSCAR DATOS ACTUALES
    $stmt = $pdo->prepare("SELECT * FROM habitats WHERE id = ?");
    $stmt->execute([$id]);
    $habitat = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$habitat) {
        $_SESSION['error'] = "El h√É¬°bitat no existe.";
        header("Location: habitats.php");
        exit();
    }

} catch (PDOException $e) {
    die("Error al cargar datos: " . $e->getMessage());
}
?>

<div class="auth-container">
    <div class="auth-card" style="max-width: 600px;">
        <div class="admin-header">
            <h2>Editar H√É¬°bitat</h2>
            <a href="habitats.php" class="btn-delete" style="background:#7f8c8d;">Cancelar</a>
        </div>

        <?php echo mostrarAlertas(); ?>

        <form action="../../actions/habitats/habitat_update_action.php" method="POST" class="form-standard">
            <input type="hidden" name="id" value="<?php echo $habitat['id']; ?>">

            <div class="form-group">
                <label>Nombre del H√É¬°bitat:</label>
                <input type="text" name="nombre" value="<?php echo limpiar($habitat['nombre']); ?>" required>
            </div>

            <div class="row" style="display:flex; gap:15px;">
                <div class="form-group" style="flex:1;">
                    <label>Tipo de Clima:</label>
                    <select name="clima" required>
                        <?php 
                        $climas = ["Selva", "Desierto", "Acu√É¬°tico", "Polar", "Aviario", "Sabana"];
                        foreach ($climas as $c): 
                        ?>
                            <option value="<?php echo $c; ?>" <?php echo ($habitat['clima'] == $c) ? 'selected' : ''; ?>>
                                <?php echo $c; ?>
                            </option>
                        <?php endforeach; ?>
                    </select>
                </div>

                <div class="form-group" style="flex:1;">
                    <label>Capacidad M√É¬°xima:</label>
                    <input type="number" name="capacidad" value="<?php echo $habitat['capacidad']; ?>" required min="1">
                </div>
            </div>

            <div class="form-group">
                <label>Descripci√É¬≥n:</label>
                <textarea name="descripcion" rows="3"><?php echo limpiar($habitat['descripcion']); ?></textarea>
            </div>

            <button type="submit" class="btn-submit" style="background:#f39c12;">Guardar Cambios</button>
        </form>
    </div>
</div>

<?php require '../../includes/footer.php'; ?>


================================================
FILE: views/admin/habitats.php
================================================
Error reading file with 'cp1252': 'charmap' codec can't decode byte 0x8f in position 4743: character maps to <undefined>


================================================
FILE: views/auth/login.php
================================================
<?php require '../../includes/header.php'; ?>

<div class="auth-container">
    <div class="auth-card">
        <h2>Iniciar Sesi√É¬≥n</h2>
        <p>Ingresa tus credenciales para acceder.</p>

        <?php echo mostrarAlertas(); ?>

        <form action="<?php echo BASE_URL; ?>actions/auth/login_action.php" method="POST" class="form-standard">
            
            <div class="form-group">
                <label for="email">Correo Electr√É¬≥nico:</label>
                <input type="email" name="email" id="email" required autofocus placeholder="tu@email.com">
            </div>

            <div class="form-group">
                <label for="password">Contrase√É¬±a:</label>
                <input type="password" name="password" id="password" required placeholder="Tu contrase√É¬±a">
            </div>

            <button type="submit" class="btn-submit">Ingresar al Sistema</button>
        </form>

        <p class="auth-link">√Ç¬øNo tienes cuenta? <a href="register.php">Reg√É¬≠strate aqu√É¬≠</a></p>
    </div>
</div>
<?php require '../../includes/footer.php'; ?>


================================================
FILE: views/auth/register.php
================================================
<?php require '../../includes/header.php'; ?>

<div class="auth-container">
    <div class="auth-card">
        <h2>Registro de Personal</h2>
        <p>Crea una cuenta para acceder al sistema ZooManager.</p>

        <?php echo mostrarAlertas(); ?>

        <form action="<?php echo BASE_URL; ?>actions/auth/register_action.php" method="POST" class="form-standard">
            
            <div class="form-group">
                <label for="nombre">Nombre Completo:</label>
                <input type="text" name="nombre_completo" id="nombre" 
                    required pattern="[A-Za-z√Å√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+" 
                    title="Solo se permiten letras y espacios" 
                    placeholder="Ej: Juan P√©rez">
            </div>

            <div class="form-group">
                <label for="email">Correo Electr√≥nico:</label>
                <input type="email" name="email" id="email" required placeholder="usuario@zoo.com">
            </div>

            <div class="form-group">
                <label for="password">Contrase√±a:</label>
                <input type="password" name="password" id="password" 
                    required minlength="8" 
                    placeholder="M√≠nimo 8 caracteres">
            </div>

            <div class="form-group">
                <label for="rol">Rol Asignado:</label>
                <select name="rol" id="rol" required>
                    <option value="" disabled selected>-- Selecciona un Rol --</option>
                    <option value="cuidador">Cuidador (Acceso limitado)</option>
                    <option value="admin">Administrador (Acceso total)</option>
                </select>
            </div>

            <button type="submit" class="btn-submit">Registrar Personal</button>
        </form>

        <p class="auth-link">¬øYa tienes una cuenta? <a href="login.php">Inicia sesi√≥n aqu√≠</a></p>
    </div>
</div>
<?php require '../../includes/footer.php'; ?>

